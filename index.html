<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­åŒ»æ—¶è¾°é’Ÿ</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: #1a1a1a;
            font-family: "Microsoft Yahei", Arial, sans-serif;
        }
		#clockContainer {
			width: 90vmin; /* å“åº”å¼å°ºå¯¸ */
			height: 90vmin;
		}
        canvas {
            position: absolute;
            top: 0;
            left: 0;
        }
        /* å…³é”®ä¿®å¤1ï¼šæ‰€æœ‰åŠ¨æ€å…ƒç´ æŒ‚è½½åˆ°æ—¶é’Ÿå®¹å™¨ */
        .clock-element {
            position: absolute;
            transform: translate(-50%, -50%);
            color: white;
            text-align: center;
            pointer-events: none;
        }
        .clickable {
            cursor: pointer;
            pointer-events: auto;
            transition: transform 0.2s;
        }
        .clickable:hover {
            transform: translate(-50%, -50%) scale(1.2);
        }
        .dizhi {
            font-size: 16px;
            width: 40px;
        }
        .organ-name {
            font-size: 20px;
            font-weight: bold;
            width: 60px;
        }
        .organ-emoji {
            font-size: 28px;
        }
        .hour-number {
            font-size: 16px;
        }
        .hour-fangwei {
            font-size: 12px;
        }
        /* æ–°å¢é—¹é’Ÿé¢æ¿æ ·å¼ */
        .alarm-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(40, 40, 40, 0.9);
            padding: 15px;
            border-radius: 10px;
            color: #fff;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        .alarm-panel input[type="time"] {
            padding: 5px;
            border: 1px solid #4CAF50;
            border-radius: 4px;
            background: #333;
            color: white;
            margin-right: 5px;
        }
        .alarm-panel button {
            padding: 5px 10px;
            background: #4CAF50;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
        }
        .alarm-panel button:hover {
            background: #45a049;
        }
        #alarmList {
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
        }
        .alarm-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
            padding: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }
        .alarm-item.active {
            background: rgba(76, 175, 80, 0.3);
        }
        .alarm-item button {
            margin-left: 8px;
            padding: 3px 6px;
            font-size: 0.8em;
            background: #e74c3c;
        }
        
        /* æ–°å¢åŠ¨ç”»æ•ˆæœ */
        @keyframes alarmFlash {
            0% { background-color: #1a1a1a; }
            50% { background-color: #4a0000; }
            100% { background-color: #1a1a1a; }
        }
        /* æ–°å¢éŸ³ä¹æ§åˆ¶é¢æ¿æ ·å¼ */
        .music-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(40,40,40,0.9);
            padding: 15px;
            border-radius: 10px;
            color: white;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        .music-controls button {
            padding: 5px 10px;
            margin: 3px;
            background: #4CAF50;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
        }
        #nowPlaying {
            margin-top: 10px;
            font-size: 0.9em;
            color: #bdc3c7;
        }
        #currentTrack {
          color: #bdc3c7;
          font-size: 14px;
          position: absolute;
          top: 10px;
          left: 10px;
          white-space: nowrap; /* é˜²æ­¢æ–‡å­—æ¢è¡Œ */
        }
        /* æ–°å¢æŒ‰é’®æç¤ºæ ·å¼ */
        .tooltip {
            position: relative;
            display: inline-block;
            margin: 0 5px;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 80px;
            background: #4CAF50;
            color: #fff;
            text-align: center;
            border-radius: 4px;
            padding: 5px 0;
            position: absolute;
            z-index: 1001;
            bottom: 125%;
            left: 50%;
            margin-left: -40px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #4CAF50 transparent transparent;
        }
		/* åŠ¨æ€æç¤ºæ ·å¼ */
		.dynamic-tip {
			position: absolute;
			bottom: 80px;
			right: -300px;
			width: 280px;
			background: rgba(40,75,99,0.95);
			border-radius: 12px;
			padding: 15px;
			transition: right 0.5s ease;
			box-shadow: 0 4px 20px rgba(0,0,0,0.3);
		}

		.dynamic-tip.show {
			right: 20px;
		}

		.tip-content h4 {
			color: #8ab4f8;
			margin-bottom: 8px;
			border-left: 3px solid currentColor;
			padding-left: 8px;
		}

		.music-info {
			margin-top: 10px;
			padding-top: 10px;
			border-top: 1px solid rgba(255,255,255,0.1);
			font-size: 0.9em;
		}
    </style>
</head>
<body>
     <!-- éŸ³ä¹æ§åˆ¶é¢æ¿ï¼ˆå¸¦æç¤ºï¼‰ -->
    <div class="music-panel">
        <div class="music-controls">
            <div class="tooltip">
                <button onclick="playPause()">â¯ï¸</button>
                <span class="tooltiptext">æ’­æ”¾/æš‚åœ</span>
            </div>
            <div class="tooltip">
                <button onclick="playNext()">â­ï¸</button>
                <span class="tooltiptext">ä¸‹ä¸€æ›²ç›®</span>
            </div>
            <div class="tooltip">
                <select id="playMode">
                    <option value="loop">é¡ºåºæ’­æ”¾</option>
                    <option value="random">éšæœºæ’­æ”¾</option>
                </select>
                <span class="tooltiptext">æ’­æ”¾æ¨¡å¼é€‰æ‹©</span>
            </div>
        <div id="nowPlaying"></div>
        </div>
    </div>

<!-- åœ¨éŸ³ä¹é¢æ¿æ·»åŠ åŠ¨æ€æç¤ºå®¹å™¨ -->

<div class="health-panel">
    <p id="healthTip"></p>
    <div class="music-info">
        â™« æ­£åœ¨æ’­æ”¾ï¼š<span id="currentTrack"></span>
    </div>
</div>

<!-- æ–°å¢é—¹é’Ÿæ§åˆ¶é¢æ¿ -->
    <div class="alarm-panel">
        <h3>é—¹é’Ÿæé†’</h3>
        <input type="time" id="alarmTime">
        <button onclick="addAlarm()">æ·»åŠ </button>
        <div id="alarmList"></div>
    </div>
    <!-- æ–°å¢éŸ³é¢‘å…ƒç´  -->
    <audio id="alarmSound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>
	
<div id="clockContainer">
    <canvas id="baseCanvas" width="800" height="800"></canvas>
    <canvas id="handsCanvas" width="800" height="800"></canvas>
</div>

<script>
// ======== æ–°å¢éŸ³ä¹æ•°æ®æ¨¡å— ========
const MUSIC_DATA = {
    'è‚': { 
        tone: 'è§’éŸ³',
        playlist: [
            'CTM-Music/æ˜¥æ±ŸèŠ±æœˆå¤œ.mp3',    // å¹³å¤æƒ…ç»ª
            'CTM-Music/ç´«ç«¹è°ƒ.mp3',   // å…»è‚åæ›²
            'CTM-Music/åº„å‘¨æ¢¦è¶.mp3'  // è§£éƒç–è‚
        ]
    },
    'è‚º': { 
        tone: 'å•†éŸ³',
        playlist: [
            'CTM-Music/é˜³æ˜¥ç™½é›ª.mp3',  // æ¶¦è‚ºé™ç‡¥
            'CTM-Music/å¹¿é™µæ•£.mp3',    // æ¸…è‚ƒå‘¼å¸
            'CTM-Music/é»„æ²³å¤§åˆå”±.mp3' // å®£è‚ºé€šçª
        ]
    },
    'å¤§è‚ ': { 
        tone: 'å•†éŸ³/å®«éŸ³',
        playlist: [
            'CTM-Music/æ½‡æ¹˜æ°´äº‘.mp3',  // é€šè…‘æ¶¦è‚ 
            'CTM-Music/æ¢…èŠ±ä¸‰å¼„.mp3',  // ä»£è°¢è°ƒç†
            'CTM-Music/åé¢åŸ‹ä¼.mp3'   // å¢å¼ºè •åŠ¨
        ]
    },
    'èƒƒ': { 
        tone: 'å®«éŸ³/ç¾½éŸ³',
        playlist: [
            'CTM-Music/å¤ç´å±±å±…åŸ.mp3', // å¥è„¾å’Œèƒƒ
            'CTM-Music/æ´åº­ç§‹æ€.mp3',  // ä¿ƒè¿›è¿åŒ–
            'CTM-Music/åŒ—å›½ä¹‹æ˜¥.mp3'   // å¼€èƒƒåŠ©é£Ÿ
        ]
    },
    'è„¾': { 
        tone: 'å®«éŸ³/å¾µéŸ³',
        playlist: [
            'CTM-Music/é«˜å±±æµæ°´.mp3',  // ç›Šæ°”è¿åŒ–
            'CTM-Music/é˜³æ˜¥.mp3',      // å¼ºå¥è‚Œç†
            'CTM-Music/èŠ±å¥½æœˆåœ†.mp3'   // è°ƒå’Œè„¾èƒƒ
        ]
    },
    'å¿ƒ': { 
        tone: 'å¾µéŸ³/ç¾½éŸ³',
        playlist: [
            'CTM-Music/ä¹Œå¤œå•¼.mp3',    // å®å¿ƒå®‰ç¥
            'CTM-Music/é›‰æœé£.mp3',    // è°ƒå’Œé˜´é˜³
            'CTM-Music/æ­¥æ­¥é«˜.mp3'     // æŒ¯å¥‹å¿ƒç¥
        ]
    },
    'å°è‚ ': { 
        tone: 'å¾µéŸ³/è§’éŸ³',
        playlist: [
            'CTM-Music/åˆ—å­å¾¡é£.mp3',  // ä¿ƒè¿›å¸æ”¶
            'CTM-Music/æ–‡ç‹æ“-æˆå…¬äº®.mp3',    // åˆ†åŒ–æ¸…æµŠ
            'CTM-Music/æ¸”èˆŸå”±æ™š.mp3'   // åŠ©æ¶ˆåŒ–æ›²
        ]
    },
    'è†€èƒ±': { 
        tone: 'ç¾½éŸ³/å•†éŸ³',
        playlist: [
            'CTM-Music/é•¿æ¸….mp3',      // åˆ©æ°´æ’æ¯’
            'CTM-Music/ç™½é›ª.mp3',      // ç–é€šç»ç»œ
            'CTM-Music/å¹³æ¹–ç§‹æœˆ.mp3'   // ä¿ƒä»£è°¢æ›²
        ]
    },
    'è‚¾': { 
        tone: 'ç¾½éŸ³/å•†éŸ³',
        playlist: [
            'CTM-Music/æµæ°´.mp3',      // æ»‹è¡¥è‚¾ç²¾
            'CTM-Music/é¹¤é¸£ä¹çš‹.mp3',  // å¼ºå¥è…°è†
            'CTM-Music/äºŒæ³‰æ˜ æœˆ.mp3'   // å…»è‚¾åæ›²
        ]
    },
    'å¿ƒåŒ…': { 
        tone: 'å¾µéŸ³/è§’éŸ³',
        playlist: [
            'CTM-Music/æ–‡ç‹æ“-æˆå…¬äº®.mp3',    // å®å¿ƒå®šå¿—
            'CTM-Music/åº„å‘¨æ¢¦è¶.mp3',  // è°ƒå’Œæƒ…å¿—
            'CTM-Music/çƒ›å½±æ‘‡çº¢.mp3'   // èˆ’ç¼“å¿ƒåŒ…
        ]
    },
    'ä¸‰ç„¦': { 
        tone: 'å•†éŸ³/å®«éŸ³',
        playlist: [
            'CTM-Music/å¹³æ²™è½é›.mp3',  // å¹³è¡¡é˜´é˜³
            'CTM-Music/å¿†æ•…äºº.mp3',    // é€šè°ƒæ°´é“
            'CTM-Music/é˜³å…³ä¸‰å .mp3'   // è°ƒå’Œä¸‰ç„¦
        ]
    },
    'èƒ†': { 
        tone: 'è§’éŸ³',
        playlist: [
            'CTM-Music/è‚èƒ†ç›¸ç…§.mp3',
            'CTM-Music/æœ¨è°ƒæ™¨æ›¦.mp3',
            'CTM-Music/èƒ¡ç¬³åå…«æ‹.mp3', // ç–è‚åˆ©èƒ†
            'CTM-Music/å§‘è‹è¡Œ.mp3'      // è°ƒè¾¾æ°”æœº
        ]
    }
};

const CLOCK_SIZE = 800;
const CLOCK_RADIUS = 400;

const SHENGXIAO = ['Rat_(zodiac)','Ox_(zodiac)','Tiger_(zodiac)','Rabbit_(zodiac)','Dragon_(zodiac)','Snake_(zodiac)','Horse_(zodiac)','Goat_(zodiac)','Monkey_(zodiac)','Rooster_(zodiac)','Dog_(zodiac)','Pig_(zodiac)'];

const HOUR_LINKS = Array.from({length: 12}, (_, i) => `https://en.wikipedia.org/wiki/${SHENGXIAO[i]}`);

//const HOUR_LINKS = Array.from({length: 24}, (_,i) => `hour${i}.html`);
console.log(HOUR_LINKS);
const FANGWEI=['å­','ç™¸','ä¸‘','è‰®','å¯…','ç”²','å¯','ä¹™','è¾°','å·½','å·³','ä¸™','åˆ','ä¸','æœª','å¤','ç”³','åºš','é…‰','è¾›','æˆŒ','ä¹¾','äº¥','å£¬'];
const DIZHI = ['å­','ä¸‘','å¯…','å¯','è¾°','å·³','åˆ','æœª','ç”³','é…‰','æˆŒ','äº¥'];
const ORGAN_DATA = [
    { name: 'è‚', emoji: 'ğŸ‰', hour: 2, tip: "ä¸‘æ—¶è‚ç»å½“ä»¤ï¼Œé™å§å…»è¡€åŠ©æ’æ¯’",musicTips:{tone: 'è§’éŸ³',effect: 'è§£éƒç–è‚ï¼Œå¹³å¤æƒ…ç»ª',tracks: ['åº„å‘¨æ¢¦è¶', 'ç¨»é¦™']}, link: "https://en.wikipedia.org/wiki/Liver_(Chinese_medicine)" },
    { name: 'è‚º', emoji: 'ğŸƒ', hour: 4, tip: "å¯…æ—¶è‚ºç»ä¸»ä»¤ï¼Œæ·±åº¦ç¡çœ æŠ¤å«æ°”",musicTips:{tone: 'å•†éŸ³',effect: 'æ¶¦è‚ºé™ç‡¥ï¼Œæ¸…è‚ƒå‘¼å¸',tracks: ['é˜³æ˜¥ç™½é›ª', 'å¹¿é™µæ•£']}, link: "https://en.wikipedia.org/wiki/Lung_(Chinese_medicine)" },
    { name: 'å¤§è‚ ', emoji: 'ğŸ›', hour: 6, tip:"å¯æ—¶å¤§è‚ ç»æ—ºï¼Œæ™¨èµ·é¥®æ°´ä¿ƒæ’æ¯’",musicTips:{tone: 'å®«éŸ³/å•†éŸ³',effect: 'é€šè…‘æ¶¦è‚ ï¼Œä»£è°¢è°ƒç†',tracks: ['æ½‡æ¹˜æ°´äº‘', 'åé¢åŸ‹ä¼']}, link: "https://en.wikipedia.org/wiki/Large_intestine_(Chinese_medicine)" },
    { name: 'èƒƒ', emoji: 'ğŸ½ï¸', hour: 8, tip: "è¾°æ—¶èƒƒç»å½“å€¼ï¼Œæ¸©çƒ­æ—©é¤å…»èƒƒæ°”",musicTips:{tone: 'å®«éŸ³/ç¾½éŸ³',effect: 'å¥è„¾å’Œèƒƒï¼Œä¿ƒè¿›è¿åŒ–',tracks: ['æ´åº­ç§‹æ€', 'å±±å±…åŸ']}, link: "https://en.wikipedia.org/wiki/Stomach_(Chinese_medicine)" },
    { name: 'è„¾', emoji: 'ğŸš', hour: 10,tip: "å·³æ—¶è„¾ç»ä¸»è¿ï¼Œé€‚åº¦æ´»åŠ¨åŠ©å¸æ”¶",musicTips:{tone: 'å®«éŸ³/å¾µéŸ³',effect: 'ç›Šæ°”è¿åŒ–ï¼Œå¼ºå¥è‚Œç†',tracks: ['é˜³æ˜¥', 'é«˜å±±æµæ°´']}, link: "https://en.wikipedia.org/wiki/Spleen_(Chinese_medicine)" },
    { name: 'å¿ƒ', emoji: 'â¤ï¸', hour: 12, tip: "åˆæ—¶å¿ƒç»å½“ä»¤ï¼Œå°æ†©å…»ç¥æŠ¤å¿ƒé˜´",musicTips:{tone: 'ç¾½éŸ³/å¾µéŸ³',effect: 'å®å¿ƒå®‰ç¥ï¼Œè°ƒå’Œé˜´é˜³',tracks: ['ä¹Œå¤œå•¼', 'é›‰æœé£']}, link: "https://en.wikipedia.org/wiki/Heart_(Chinese_medicine)" },
    { name: 'å°è‚ ', emoji: 'ğŸ”—', hour: 14,tip: "æœªæ—¶å°è‚ ç»æ—ºï¼Œè¥å…»åˆé¤åŠ©å¸æ”¶",musicTips:{tone: 'å¾µéŸ³/è§’éŸ³',effect: 'ä¿ƒè¿›å¸æ”¶ï¼Œåˆ†åŒ–æ¸…æµŠ',tracks: ['åˆ—å­å¾¡é£', 'æ–‡ç‹æ“']}, link: "https://en.wikipedia.org/wiki/Small_intestine_(Chinese_medicine)" },
    { name: 'è†€èƒ±', emoji: 'ğŸš°', hour: 16,tip: "ç”³æ—¶è†€èƒ±ç»è¡Œï¼Œå¤šé¥®æ¸©æ°´ä¿ƒä»£è°¢",musicTips:{tone: 'ç¾½éŸ³/å•†éŸ³',effect: 'åˆ©æ°´æ’æ¯’ï¼Œç–é€šç»ç»œ',tracks: ['ç™½é›ª', 'é•¿æ¸…']}, link: "https://en.wikipedia.org/wiki/Urinary_bladder_(Chinese_medicine)" },
    { name: 'è‚¾', emoji: 'ğŸ¥œ', hour: 18, tip: "å°‘ç›é¥®é£ŸæŠ¤è‚¾æ°”ï¼Œé…‰æ—¶è¡¥è‚¾æ•ˆæœä½³",musicTips: {tone: 'ç¾½éŸ³',effect: 'æ»‹è¡¥è‚¾æ°”ï¼Œå›ºæœ¬åŸ¹å…ƒ',tracks: ['æµæ°´', 'é¹¤é¸£ä¹çš‹']}, link: "https://en.wikipedia.org/wiki/Kidney_(Chinese_medicine)" },
    { name: 'å¿ƒåŒ…', emoji: 'ğŸ§˜', hour: 20,tip: "æˆŒæ—¶å¿ƒåŒ…ç»ä¸»ï¼Œæ”¾æ¾å¨±ä¹èˆ’å¿ƒæ°”",musicTips:{tone: 'å¾µéŸ³/è§’éŸ³',effect: 'å®å¿ƒå®šå¿—ï¼Œè°ƒå’Œæƒ…å¿—',tracks: ['æ–‡ç‹æ“', 'åº„å‘¨æ¢¦è¶']}, link: "https://en.wikipedia.org/wiki/Pericardium_(Chinese_medicine)" }, 
    { name: 'ä¸‰ç„¦', emoji: 'ğŸ”¥', hour: 22,tip: "äº¥æ—¶ä¸‰ç„¦ç»è¡Œï¼Œé™å¿ƒå…¥çœ é€šç™¾è„‰",musicTips:{tone: 'å•†éŸ³/å®«éŸ³',effect: 'å¹³è¡¡é˜´é˜³ï¼Œé€šè°ƒæ°´é“',tracks: ['å¹³æ²™è½é›', 'å¿†æ•…äºº']}, link: "https://en.wikipedia.org/wiki/San_Jiao" },
    { name: 'èƒ†', emoji: 'ğŸŸ¢', hour: 24,tip:"å­æ—¶èƒ†ç»è¿è¡Œï¼Œå®œæ·±åº¦ç¡çœ ä¿ƒè¿›èƒ†æ±åˆ†æ³Œ",musicTips: {tone: 'è§’éŸ³',effect: 'ç–è‚åˆ©èƒ†ï¼Œè°ƒå’Œæ°”è¡€',tracks: ['æ¢…èŠ±ä¸‰å¼„', 'æ½‡æ¹˜æ°´äº‘']}, link: "https://en.wikipedia.org/wiki/Gallbladder_(Chinese_medicine)" }
];

// ======== éŸ³ä¹æ’­æ”¾ç³»ç»Ÿ ========
let currentOrgan = null;
let audioPlayer = new Audio();
let currentTrackIndex = 0;
let isMusicPlaying = false;

// æ ¹æ®æ—¶è¾°é€‰æ‹©éŸ³ä¹
function selectOrganMusic() {
    const currentHour = new Date().getHours();
    const organs = ORGAN_DATA.filter(o => 
        currentHour >= o.hour-1 && currentHour < o.hour+1
    );
    
    if (organs.length > 0) {
        const organ = organs[0].name;
        if (organ !== currentOrgan) {
            currentOrgan = organ;
            currentTrackIndex = 0;
            loadTrack();
        }
    }
}
// åœ¨loadTrack()ä¸­æ·»åŠ [7]
async function loadTrack() {
    try {
        if (!currentOrgan || !MUSIC_DATA[currentOrgan]) {
            console.warn("Organ music data not found or invalid.");
            return;
        }
        
        const playlist = MUSIC_DATA[currentOrgan].playlist;
        if (!playlist || playlist.length === 0) {
            console.warn("Playlist is empty for the current organ.");
            return;
        }

        audioPlayer.src = playlist[currentTrackIndex];
        await audioPlayer.play();
        isMusicPlaying = true;
		updateDisplay();
    } catch (error) {
        console.error('éŸ³ä¹æ’­æ”¾å¤±è´¥:', error);
        isMusicPlaying = false;
        playNext(); // Attempt to play the next track on error
    }
}



// æ§åˆ¶åŠŸèƒ½
function playPause() {
    if (audioPlayer.paused) {
        audioPlayer.play().catch(error => {
            console.error("Error resuming playback:", error);
        });
    } else {
        audioPlayer.pause();
    }
    updateDisplay();
}


function playNext() {
    const mode = document.getElementById('playMode').value;
    if (mode === 'random') {
        currentTrackIndex = Math.floor(Math.random() * MUSIC_DATA[currentOrgan].playlist.length);
    } else {
        currentTrackIndex = (currentTrackIndex + 1) % MUSIC_DATA[currentOrgan].playlist.length;
    }
    loadTrack();
}

// æ›´æ–°æ˜¾ç¤º
function updateDisplay() {
    const fileName = decodeURIComponent(audioPlayer.src.split('/').pop());
    const info = `${currentOrgan}ç»å½“ä»¤ | ${MUSIC_DATA[currentOrgan].tone}|${fileName}`;
    //const info = `${currentOrgan}ç»å½“ä»¤ | ${MUSIC_DATA[currentOrgan].tone}|${audioPlayer.src.split('/').pop()}`;
    document.getElementById('nowPlaying').textContent = info;
  // ä½¿ç”¨ setTimeout ç¡®ä¿æ¸²æŸ“é¡ºåº
// setTimeout(() => {
//   const info = `${currentOrgan}ç»å½“ä»¤ | ${MUSIC_DATA[currentOrgan].tone} | ${audioPlayer.src.split('/').pop()}`;
//   document.getElementById('nowPlaying').textContent = info;
// }, 0);
//  // æ˜¾å¼è½¬ä¹‰æ›²ç›®åç§°
// const trackName = organ.musicTips.tracks[0]? organ.musicTips.tracks[0]:'æœªçŸ¥æ›²ç›®';
// document.getElementById('currentTrack').textContent=`${organ.musicTips.tone} - ${encodeURIComponent(trackName)}`; 
}

// åŠ¨æ€æç¤ºæ§åˆ¶å™¨
class DynamicTip {
update() {
        try {
            const now = new Date();
            const currentHour = now.getHours();
            const organ = ORGAN_DATA.find(o => 
                currentHour >= o.hour-1 && currentHour < o.hour+1
            );
            
            if (organ) {
			   this.currentOrganElement.textContent = organ.name;
			   this.healthTipElement.innerHTML = `${organ.tip}<small>${organ.musicTips.effect}</small>`;
			   this.trackElement.textContent = `${organ.musicTips.tone}-${organ.musicTips.tracks[0]}`;
			   this.emojiElement.textContent = organ.emoji;
			   
			   // åŠ¨æ€æ ·å¼[6]
			   this.tipElement.style.background = this.getOrganColor(organ.name);
			   this.tipElement.classList.add('show');
			   setTimeout(() => this.tipElement.classList.remove('show'), 5000);
            }
        } catch (error) {
            console.error('åŠ¨æ€æç¤ºæ›´æ–°å¤±è´¥:', error);
        }
    }
}

// åˆå§‹åŒ–Canvas
const baseCanvas = document.getElementById('baseCanvas');
const handsCanvas = document.getElementById('handsCanvas');
const baseCtx = baseCanvas.getContext('2d');
const handsCtx = handsCanvas.getContext('2d');
const clockContainer = document.getElementById('clockContainer'); // å®¹å™¨å¼•ç”¨

function init() {
   // const dpr = window.devicePixelRatio || 1;
   // baseCanvas.width = handsCanvas.width = CLOCK_SIZE * dpr;
   // baseCanvas.height = handsCanvas.height = CLOCK_SIZE * dpr;
   // baseCtx.scale(dpr, dpr);
   // handsCtx.scale(dpr, dpr);
	
    drawStaticElements();
    createDizhiElements();
    createOrganElements();
    createHourNumbers();
    createHourFangWei();
    updateClock();
}

// ç»˜åˆ¶é™æ€å…ƒç´ 
function drawStaticElements() {
    // å¤–åœˆ
    baseCtx.strokeStyle = "#ecf0f1";
    baseCtx.lineWidth = 4;
    baseCtx.beginPath();
//context . arc(x, y, radius, startAngle, endAngle [, anticlockwise ] )
    baseCtx.arc(CLOCK_RADIUS, CLOCK_RADIUS, CLOCK_RADIUS-110, 0, Math.PI*2);
    baseCtx.stroke();
    baseCtx.strokeStyle ="hsl("+ Math.random() * 360 + ",100%,50%)";
    baseCtx.lineWidth = 1;
    baseCtx.beginPath();
    baseCtx.arc(CLOCK_RADIUS, CLOCK_RADIUS, CLOCK_RADIUS-210, 0, Math.PI*2);
    baseCtx.stroke();
    baseCtx.strokeStyle ="hsl("+ Math.random() * 360 + ",100%,50%)";
    baseCtx.lineWidth = 3;
    baseCtx.beginPath();
    baseCtx.arc(CLOCK_RADIUS, CLOCK_RADIUS, CLOCK_RADIUS-190, 0, Math.PI*2);
    baseCtx.stroke();

    // è™šçº¿æ—¶è¾°åˆ’åˆ†
    baseCtx.lineWidth = 1;
    baseCtx.setLineDash([1, 8]);
    baseCtx.strokeStyle = "rgba(255,255,255,0.5)";
    for(let i=0; i<12; i++) {
        const angle = (i * Math.PI/6) - 7*Math.PI/12;
        baseCtx.beginPath();
        baseCtx.moveTo(CLOCK_RADIUS, CLOCK_RADIUS);
        baseCtx.lineTo(
            CLOCK_RADIUS + (CLOCK_RADIUS-110)*Math.cos(angle),
            CLOCK_RADIUS + (CLOCK_RADIUS-110)*Math.sin(angle)
        );
        baseCtx.stroke();
    }
    // è™šçº¿æ—¶é’Ÿåˆ’åˆ†
    baseCtx.lineWidth = .5;
    baseCtx.setLineDash([5, 5]);
    baseCtx.strokeStyle = "rgba(255,255,255,0.9)";
    for(let i=0; i<12; i++) {
        const angle = (i * Math.PI/6) - 6*Math.PI/12;
        baseCtx.beginPath();
        //baseCtx.moveTo(CLOCK_RADIUS, CLOCK_RADIUS);
        baseCtx.moveTo(CLOCK_RADIUS+ (CLOCK_RADIUS-330)*Math.cos(angle), CLOCK_RADIUS+ (CLOCK_RADIUS-330)*Math.sin(angle));
        baseCtx.lineTo(
            CLOCK_RADIUS + (CLOCK_RADIUS-230)*Math.cos(angle),
            CLOCK_RADIUS + (CLOCK_RADIUS-230)*Math.sin(angle)
        );
        baseCtx.stroke();
    }
    baseCtx.setLineDash([]);
}

// åˆ›å»ºåœ°æ”¯å…ƒç´ 
function createDizhiElements() {
    DIZHI.forEach((dz, index) => {
        const angle = (index * Math.PI/6) - Math.PI/2;
        const pos = getPosition(angle, CLOCK_RADIUS-350);
       
        const elem = document.createElement('div');
        elem.className = 'clock-element dizhi clickable';
        elem.style.left = pos.x + 'px';
        elem.style.top = pos.y + 'px';
        elem.textContent = dz;
        elem.onclick = () => window.open(HOUR_LINKS[index], '_blank');
        clockContainer.appendChild(elem); // å…³é”®ä¿®å¤2ï¼šæŒ‚è½½åˆ°å®¹å™¨
    });
}

// åˆ›å»ºè„è…‘å…ƒç´ 
function createOrganElements() {
    ORGAN_DATA.forEach(organ => {
        const angle = (organ.hour * Math.PI/12) - 6* Math.PI/12;
        const pos = getPosition(angle, CLOCK_RADIUS-140);

        const container = document.createElement('div');
        container.className = 'clock-element clickable';
        container.style.left = pos.x + 'px';
        container.style.top = pos.y + 'px';
        container.dataset.link = organ.link;
        container.title = `[${organ.hour-1}~${(organ.hour+1)%24}]ç‚¹ï¼š ${organ.tip}`;
        container.onclick = () => window.open(container.dataset.link, '_blank');//Use the data attribute in the onclick function

        const nameElem = document.createElement('div');
        nameElem.className = 'organ-name';
        nameElem.textContent = organ.name;

        const emojiElem = document.createElement('div');
        emojiElem.className = 'organ-emoji';
        emojiElem.textContent = organ.emoji;

        container.appendChild(nameElem);
        container.appendChild(emojiElem);
        clockContainer.appendChild(container); // å…³é”®ä¿®å¤2ï¼šæŒ‚è½½åˆ°å®¹å™¨
    });
}

// åˆ›å»ºå°æ—¶æ•°å­—
function createHourNumbers() {
    for(let hour=0; hour<24; hour++){
        const angle = (hour * Math.PI/12) - 6*Math.PI/12;
        const pos = getPosition(angle, CLOCK_RADIUS-200);
       
        const div = document.createElement('div');
        div.className = 'clock-element hour-number';
        div.style.left = pos.x + 'px';
        div.style.top = pos.y + 'px';
        div.textContent = hour;
        clockContainer.appendChild(div); // å…³é”®ä¿®å¤2ï¼šæŒ‚è½½åˆ°å®¹å™¨
    }
}

function createHourFangWei() {
    for(let hour=0; hour<24; hour++){
        const angle = (hour * Math.PI/12) - 6*Math.PI/12;
        const pos = getPosition(angle, CLOCK_RADIUS-220);
       
        const div = document.createElement('div');
        div.className = 'clock-element hour-fangwei';
        div.style.left = pos.x + 'px';
        div.style.top = pos.y + 'px';
        div.textContent = FANGWEI[hour];
        clockContainer.appendChild(div); 
    }
}

// è·å–åæ ‡
function getPosition(angle, radius) {
    return {
        x: CLOCK_RADIUS + radius * Math.cos(angle),
        y: CLOCK_RADIUS + radius * Math.sin(angle)
    };
}
// ======= æ–°å¢é—¹é’ŸåŠŸèƒ½æ¨¡å— =======
class Alarm {
    constructor(hour, minute) {
        this.hour = parseInt(hour);
        this.minute = parseInt(minute);
        this.active = true;
        this.id = Date.now().toString(36) + Math.random().toString(36).substr(2);
    }
}

let alarms = [];
let lastTriggerTime = 0;

// æ·»åŠ é—¹é’Ÿ
function addAlarm() {
    const timeInput = document.getElementById('alarmTime');
    if (!timeInput.value) return;

    const [hour, minute] = timeInput.value.split(':');
    alarms.push(new Alarm(hour, minute));
    updateAlarmDisplay();
    timeInput.value = '';
}

// åˆ é™¤é—¹é’Ÿ
function deleteAlarm(id) {
    alarms = alarms.filter(alarm => alarm.id !== id);
    updateAlarmDisplay();
}

// åˆ‡æ¢é—¹é’ŸçŠ¶æ€
function toggleAlarm(id) {
    const alarm = alarms.find(a => a.id === id);
    if (alarm) alarm.active = !alarm.active;
    updateAlarmDisplay();
}

// æ›´æ–°æ˜¾ç¤º
function updateAlarmDisplay() {
    const list = document.getElementById('alarmList');
    list.innerHTML = alarms.map(alarm => `
        <div class="alarm-item ${alarm.active ? 'active' : ''}">
            <span>${String(alarm.hour).padStart(2, '0')}:${String(alarm.minute).padStart(2, '0')}</span>
            <button onclick="toggleAlarm('${alarm.id}')">${alarm.active ? 'å…³é—­' : 'æ¿€æ´»'}</button>
            <button onclick="deleteAlarm('${alarm.id}')">åˆ é™¤</button>
        </div>
    `).join('');
}

// æ£€æŸ¥é—¹é’Ÿè§¦å‘
function checkAlarms(now) {
    const currentMinute = now.getHours() * 60 + now.getMinutes();
    
    alarms.forEach(alarm => {
        if (alarm.active && 
            alarm.hour === now.getHours() &&
            alarm.minute === now.getMinutes() &&
            Date.now() - lastTriggerTime > 60000 // æ¯åˆ†é’Ÿè§¦å‘ä¸€æ¬¡
        ) {
            triggerAlarm();
            lastTriggerTime = Date.now();
        }
    });
}

// è§¦å‘æé†’
function triggerAlarm() {
    const sound = document.getElementById('alarmSound');
    sound.play();
    document.body.style.animation = 'alarmFlash 0.5s 3';
}

// æ—¶é’ŸæŒ‡é’ˆåŠŸèƒ½======= ä¿®æ”¹æ—¶é’Ÿæ›´æ–°å‡½æ•° =======
function updateClock() {
    try {
        const now = new Date();
        const hours = now.getHours();
        const minutes = now.getMinutes();
        const seconds = now.getSeconds();

        // ç»˜åˆ¶æŒ‡é’ˆ
        handsCtx.clearRect(0, 0, CLOCK_SIZE, CLOCK_SIZE);
        drawHand(hours * 15 + minutes * 0.25, 160, 8, "#ecf0f1");
        drawHand(minutes * 6 + seconds * 0.1, 180, 6, "#bdc3c7"); 
        drawHand(seconds * 6, 240, 4, "#e74c3c");

        // æ¯5åˆ†é’Ÿæ£€æŸ¥éŸ³ä¹ï¼ˆåŸé€»è¾‘æœ‰å˜é‡é”™è¯¯ï¼‰
        if (now.getMinutes() % 5 === 0) {
            selectOrganMusic(); // ç§»é™¤é”™è¯¯å‚æ•°
        }
        
        checkAlarms(now);
    } catch (error) {
        console.error('æ—¶é’Ÿæ›´æ–°é”™è¯¯:', error);
    } finally {
        requestAnimationFrame(updateClock); // ç¡®ä¿å¾ªç¯æŒç»­
    }
}

function drawHand(degrees, length, width, color) {
    const radian = (degrees - 90) * Math.PI / 180;
//  let radian = (Math.PI / 180) * angle - Math.PI / 2;
    handsCtx.beginPath();
    handsCtx.lineWidth = width;
    handsCtx.strokeStyle = color;
    handsCtx.lineCap = "round";
    handsCtx.moveTo(CLOCK_RADIUS, CLOCK_RADIUS);
    handsCtx.lineTo(
        CLOCK_RADIUS + length * Math.cos(radian),
        CLOCK_RADIUS + length * Math.sin(radian)
    );
    handsCtx.stroke();
}

// åˆå§‹åŒ–

// ======== åˆå§‹åŒ–éŸ³ä¹æ’­æ”¾å™¨ ========
audioPlayer.addEventListener('ended', () => {
    try {
        playNext();
    } catch (error) {
        console.error('è‡ªåŠ¨æ’­æ”¾å¤±è´¥:', error);
    }
});
audioPlayer.volume = 0.5; // åˆå§‹éŸ³é‡

init();
</script>
</body>
</html>
